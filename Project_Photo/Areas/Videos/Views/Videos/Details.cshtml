@model Project_Photo.Areas.Videos.Models.ViewModels.VideoViewModel

@{
	ViewData["Title"] = "Video Details";
}

@section Styles{

	<style>
		.description-text {
			white-space: pre-wrap;
			word-wrap: break-word;
			line-height: 1.6;
		}

		.stat-box {
			transition: transform 0.2s, box-shadow 0.2s;
			border: 1px solid #e9ecef;
		}

			.stat-box:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 8px rgba(0,0,0,0.1);
			}

		dl dt {
			font-weight: 500;
		}

		dl dd {
			margin-bottom: 0.75rem;
		}

		.card-header h4 {
			font-weight: 600;
		}
	</style>

}


<div class="container mt-4">
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h1 class="mb-0">
			<i class="bi bi-play-circle-fill text-primary me-2"></i>Video Details
		</h1>
	</div>

	<div class="card shadow-sm">
		<div class="card-header bg-primary text-white py-3">
			<h4 class="mb-0">@Model.Video.Title</h4>
		</div>
		<div class="card-body p-4">
			<div class="row g-4">
				<!-- 左側：影片播放器/縮圖 -->
				<div class="col-lg-5">
					<div class="video-container mb-3">
						@if (!string.IsNullOrEmpty(Model.Video.VideoUrl))
						{
							<div class="ratio ratio-16x9 rounded overflow-hidden shadow-sm">
								<video controls poster="@Model.Video.ThumbnailUrl" class="w-100">
									<source src="@Model.Video.VideoUrl" type="video/mp4">
									Your browser does not support the video tag.
								</video>
							</div>
						}
						else if (!string.IsNullOrEmpty(Model.Video.ThumbnailUrl))
						{
							<img src="@Model.Video.ThumbnailUrl" class="img-fluid rounded shadow-sm w-100" alt="Video Thumbnail">
						}
						else
						{
							<div class="ratio ratio-16x9 bg-light rounded d-flex align-items-center justify-content-center">
								<div class="text-center text-muted">
									<i class="bi bi-camera-video fs-1"></i>
									<p class="mb-0 mt-2">No Video Available</p>
								</div>
							</div>
						}
					</div>

					<!-- 統計資訊卡片 -->
					<div class="card border-0 bg-light">
						<div class="card-body p-3">
							<h6 class="card-title mb-3 text-secondary">
								<i class="bi bi-bar-chart-fill me-1"></i>Statistics
							</h6>
							<div class="row g-2 text-center">
								<div class="col-6">
									<div class="stat-box p-2 bg-white rounded">
										<i class="bi bi-eye-fill text-info fs-4"></i>
										<div class="mt-1 fw-bold">@(Model.ViewCount)</div>
										<small class="text-muted">Views</small>
									</div>
								</div>
								<div class="col-6">
									<div class="stat-box p-2 bg-white rounded">
										<i class="bi bi-heart-fill text-danger fs-4"></i>
										<div class="mt-1 fw-bold">@(Model.LikeCount)</div>
										<small class="text-muted">Likes</small>
									</div>
								</div>
								<div class="col-6">
									<div class="stat-box p-2 bg-white rounded">
										<i class="bi bi-chat-left-text-fill text-success fs-4"></i>
										<div class="mt-1 fw-bold">@(Model.CommentCount)</div>
										<small class="text-muted">Comments</small>
									</div>
								</div>
								<div class="col-6">
									<div class="stat-box p-2 bg-white rounded">
										<i class="bi bi-flag-fill text-warning fs-4"></i>
										@* <div class="mt-1 fw-bold">@(Model.Video.ReportCount ?? 0)</div> *@
										<small class="text-muted">Reports</small>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- 右側：詳細資訊 -->
				<div class="col-lg-7">
					<!-- 基本資訊 -->
					<div class="mb-4">
						<h5 class="border-bottom pb-2 mb-3">
							<i class="bi bi-info-circle me-2"></i>Basic Information
						</h5>
						<dl class="row mb-2">
							<dt class="col-sm-4 text-muted">Channel ID</dt>
							<dd class="col-sm-8">
								<span class="badge bg-secondary">@Model.Video.ChannelId</span>
							</dd>

							<dt class="col-sm-4 text-muted">Description</dt>
							<dd class="col-sm-8">
								@if (!string.IsNullOrEmpty(Model.Video.Description))
								{
									<div class="description-text">@Model.Video.Description</div>
								}
								else
								{
									<span class="text-muted fst-italic">No description provided</span>
								}
							</dd>
						</dl>
					</div>

					<!-- 技術資訊 -->
					<div class="mb-4">
						<h5 class="border-bottom pb-2 mb-3">
							<i class="bi bi-gear me-2"></i>Technical Details
						</h5>
						<dl class="row mb-2">
							<dt class="col-sm-4 text-muted">
								<i class="bi bi-clock me-1"></i>Duration
							</dt>
							<dd class="col-sm-8">
								<strong>@(TimeSpan.FromSeconds(Convert.ToDouble(Model.Video.Duration)).ToString(@"mm\:ss"))</strong>
							</dd>

							<dt class="col-sm-4 text-muted">
								<i class="bi bi-aspect-ratio me-1"></i>Resolution
							</dt>
							<dd class="col-sm-8">
								<span class="badge bg-info">@Model.Video.Resolution</span>
							</dd>

							<dt class="col-sm-4 text-muted">
								<i class="bi bi-file-earmark me-1"></i>File Size
							</dt>
							<dd class="col-sm-8">
								@{
									long fileSize = (long)Model.Video.FileSize;
									string readableSize;
									if (fileSize >= 1024 * 1024 * 1024)
									{
										readableSize = (fileSize / (1024.0 * 1024 * 1024)).ToString("0.##") + " GB";
									}
									else if (fileSize >= 1024 * 1024)
									{
										readableSize = (fileSize / (1024.0 * 1024)).ToString("0.##") + " MB";
									}
									else if (fileSize >= 1024)
									{
										readableSize = (fileSize / 1024.0).ToString("0.##") + " KB";
									}
									else
									{
										readableSize = fileSize + " B";
									}
								}
								<strong>@readableSize</strong>
							</dd>
						</dl>
					</div>

					<!-- 狀態資訊 -->
					<div class="mb-4">
						<h5 class="border-bottom pb-2 mb-3">
							<i class="bi bi-toggle-on me-2"></i>Status
						</h5>
						<dl class="row mb-2">
							<dt class="col-sm-4 text-muted">Process Status</dt>
							<dd class="col-sm-8">
								@{
									string processStatusClass = Model.Video.ProcessStatus?.ToLower() switch
									{
										"completed" => "bg-success",
										"processing" => "bg-warning",
										"failed" => "bg-danger",
										_ => "bg-secondary"
									};
								}
								<span class="badge @processStatusClass">@Model.Video.ProcessStatus</span>
							</dd>

							<dt class="col-sm-4 text-muted">Privacy Status</dt>
							<dd class="col-sm-8">
								@{
									string privacyStatusClass = Model.Video.PrivacyStatus?.ToLower() switch
									{
										"public" => "bg-success",
										"private" => "bg-danger",
										"unlisted" => "bg-warning",
										_ => "bg-secondary"
									};
								}
								<span class="badge @privacyStatusClass">@Model.Video.PrivacyStatus</span>
							</dd>

							<dt class="col-sm-4 text-muted">Created At</dt>
							<dd class="col-sm-8">
								<i class="bi bi-calendar-plus me-1"></i>
								@Model.Video.CreatedAt.ToString("yyyy-MM-dd HH:mm")
							</dd>

							<dt class="col-sm-4 text-muted">Updated At</dt>
							<dd class="col-sm-8">
								<i class="bi bi-calendar-check me-1"></i>
								@Model.Video.UpdateAt.ToString("yyyy-MM-dd HH:mm")
							</dd>
						</dl>
					</div>

					<!-- 操作按鈕 -->
					<div class="d-flex gap-2 pt-3 border-top">
						<a asp-action="Edit" asp-route-id="@Model.Video.VideoId" class="btn btn-warning">
							<i class="bi bi-pencil-square me-1"></i>Edit
						</a>
						<button type="button" class="btn btn-sm btn-outline-danger delete-video-btn" data-video-id="@Model.Video.VideoId" title="刪除">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-xs"><path d="M4 7h16" /><path d="M10 11v6" /><path d="M14 11v6" /><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" /><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" /></svg>
						</button>
						<a asp-action="Index" class="btn btn-outline-secondary">
							<i class="bi bi-arrow-left me-1"></i>Back to List
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script>
	//刪除
	document.addEventListener('DOMContentLoaded', function() {
	    const deleteButtons = document.querySelectorAll('.delete-video-btn');

	    deleteButtons.forEach(button => {
	        button.addEventListener('click', function() {
	            const videoId = this.getAttribute('data-video-id');
	            const confirmation = confirm('確定要刪除這部影片嗎？此操作為軟刪除。');

	            if (confirmation) {
	                const url = `/Videos/Videos/DeleteVideo/${videoId}`; // ✅ 修改這裡

	                fetch(url, {
	                    method: 'DELETE',
	                })
	                .then(response => {
	                    if (response.ok) {
	                        alert('影片刪除成功！');
							window.location.href = '/Videos/Videos/';
	                    } else if (response.status === 401) {
	                        alert('刪除失敗：請先登入。');
	                    } else if (response.status === 403) {
	                        alert('刪除失敗：您沒有權限刪除此影片。');
	                    } else if (response.status === 404) {
	                        alert('刪除失敗：影片未找到。');
	                    } else {
	                        return response.json().then(data => {  // ✅ 修改這裡
	                            alert('刪除失敗: ' + (data.message || '未知錯誤'));
	                        });
	                    }
	                })
	                .catch(error => {
	                    console.error('刪除請求出錯:', error);
	                    alert('刪除請求出錯，請檢查網路連線或稍後再試。');
	                });
	            }
	        });
	    });
	});
	</script>
}
