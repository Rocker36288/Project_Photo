
@model IEnumerable<Project_Photo.Areas.Videos.Models.Channel>
@{
	ViewData["Title"] = "é »é“ç®¡ç†åˆ—è¡¨";
}

<div class="container mt-5">
	<h2><i class="fas fa-list-alt"></i> é »é“ç®¡ç†åˆ—è¡¨</h2>
	<hr />

	<div class="mb-3">
		<button id="initializeBtn" class="btn btn-success">
			<i class="fas fa-magic"></i> æ‰¹é‡åˆå§‹åŒ–æœªå‰µå»ºçš„é »é“
		</button>
		<span id="initializationMessage" class="ms-3 text-info"></span>
	</div>

	@if (Model == null || !Model.Any())
	{
		<div class="alert alert-warning" role="alert">
			ç›®å‰æ²’æœ‰ä»»ä½•é »é“è³‡æ–™ã€‚è«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•é€²è¡Œåˆå§‹åŒ–ã€‚
		</div>
	}
	else
	{
		<table class="table table-striped table-hover">
			<thead>
				<tr>
					<th>
						@Html.DisplayNameFor(model => model.ChannelId)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.ChannelName)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.Description)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.CreatedAt)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.UpdateAt)
					</th>
					<th>æ“ä½œ</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in Model)
				{
					<tr>
						<td>
							@Html.DisplayFor(modelItem => item.ChannelId)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.ChannelName)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.Description)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.CreatedAt)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.UpdateAt)
						</td>
						<td>
							<a asp-action="Details" asp-route-id="@item.ChannelId" class="btn btn-sm btn-outline-info me-1" title="æŸ¥çœ‹è©³æƒ…">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-xs"><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
							</a>
							<a asp-action="Edit" asp-route-id="@item.ChannelId" class="btn btn-sm btn-warning">ç·¨è¼¯</a>
						</td>
					</tr>
				}
			</tbody>
		</table>
	}
</div>

@section Scripts {
	<script>
		document.getElementById('initializeBtn').addEventListener('click', async () => {
			const messageElement = document.getElementById('initializationMessage');
			messageElement.textContent = 'æ­£åœ¨åˆå§‹åŒ–ï¼Œè«‹ç¨å€™...';

			// ğŸ’¡ å‘¼å«å¾Œå°çš„åˆå§‹åŒ– Action
			const response = await fetch('/Videos/Channel/InitializeChannels', {
				method: 'POST',
				// ç¢ºä¿ç™¼é€ Anti-Forgery Token
				headers: {
					'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
				}
			});

			if (response.ok) {
				const result = await response.json();

				// âœ¨ é—œéµä¿®å¾©ï¼šå°‡ Success, Message, Count æ”¹ç‚ºå°å¯«çš„ success, message, count âœ¨
				if (result.success) { // <-- å·²ä¿®æ­£ç‚ºå°å¯« 'success'
					messageElement.textContent = `${result.message} (å…±å»ºç«‹ ${result.count} ç­†)`; // <-- å·²ä¿®æ­£ç‚ºå°å¯« 'message' å’Œ 'count'
					// åˆå§‹åŒ–å®Œæˆå¾Œï¼Œé‡æ–°æ•´ç†é é¢ä»¥é¡¯ç¤ºæ–°è³‡æ–™
					setTimeout(() => {
						window.location.reload();
					}, 2000);
				} else {
					messageElement.textContent = `åˆå§‹åŒ–å¤±æ•—: ${result.message}`; // <-- å·²ä¿®æ­£ç‚ºå°å¯« 'message'
				}
			} else {
				messageElement.textContent = 'åˆå§‹åŒ–è«‹æ±‚å¤±æ•—ï¼Œè«‹æª¢æŸ¥ä¼ºæœå™¨æ—¥èªŒã€‚';
			}
		});
	</script>
}
